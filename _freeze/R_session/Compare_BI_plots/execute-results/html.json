{
  "hash": "af8ab40fba1549a2c88d02c1dff88fb9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Number_Trees_BI_nDOM\"\nformat: html\nknitr:\n  opts_chunk: \n    eval: false\neditor: visual\n---\n\n\n\n\n## Compare number of trees in BI plots: detected with remote sensing vs measured in field\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(foreign)\n```\n:::\n\n\n\n\nLoad BI plots, BI trees and trees detected in ndom (created in previous script).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplots_bi <- st_read(here(\"R_session\", \"data\", \"buffer13_bi_mittelpunkt_solling_2023.gpkg\"))\n\ntrees_bi <- st_read(here(\"R_session\", \"data\", \"bi_baeume_vorrat_solling_2023.gpkg\"))\n\ntrees_ndom <- st_read(here(\"R_session\", \"data\", \"ttops_bi_ndom.gpkg\"))\n```\n:::\n\n\n\n\nLoad table with median slope in the BI plot and bind with plots BI table\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslope_bi_plot <- read.dbf(here(\"R_session\", \"data\", \"bi_plot_median_slope.dbf\"))\nplots_bi <- bind_cols(plots_bi, slope_bi_plot %>% select(X_median))\nrm(slope_bi_plot)\n```\n:::\n\n\n\n\nCount how many bi trees inside plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nintersection_bi_trees_plots <- st_intersection(x = plots_bi, y = trees_bi)\n\ncount_bi_trees_plot <- intersection_bi_trees_plots %>% \n    add_count(KSPNR, name = \"n_trees_bi\") %>% \n    group_by(KSPNR) %>% \n    slice(n()) %>% \n    ungroup() \n```\n:::\n\n\n\n\nOptional: Trees_bi 2638 observations, intersection_bi_trees_plots 2606 observations, check reason from this difference\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#st_erase = function(x, y) st_difference(x, st_union(st_combine(y)))\n\n#difference <- st_erase(trees_bi , intersection_bi_trees_plots)\n\n#writeVector(vect(difference), here(\"output\", \"trees_not_bi.gpkg\"), overwrite=TRUE)\n```\n:::\n\n\n\n\nCount how many ndom trees inside plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nintersection_ndom_trees_plots <- st_intersection(x = plots_bi, y = trees_ndom)\n\ncount_ndom_trees_plot <- intersection_ndom_trees_plots %>% \n    add_count(KSPNR, name = \"n_trees_ndom\") %>% \n    group_by(KSPNR) %>% \n    slice(n()) %>% \n    ungroup() \n```\n:::\n\n\n\n\nMerge table with number trees from ndom and table with number trees from BI\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount_trees_bi_ndom <- merge(as.data.frame(count_ndom_trees_plot), as.data.frame(count_bi_trees_plot), by = \"KSPNR\")\n```\n:::\n\n\n\n\nPlot to compare the number of trees in each plot taking slope of plot into account\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- ggplot(count_trees_bi_ndom, aes(x=n_trees_bi, y=n_trees_ndom,        colour=X_median.x)) + \n              xlim(0,30) + ylim(0,30) +\n              geom_abline(slope=1) +\n              geom_point() +\n              scale_colour_gradientn(colours=rainbow(4)) +\n              labs(title = \"Number of trees in each plot measured in BI vs detected with nDOM\", \n              x = \"Number of trees measured in BI\",\n              y = \"Number of trees detected in nDOM\",\n              color = \"Terrain slope [degree]\") +\n              theme(plot.title = element_text(hjust = 0.5))\n```\n:::\n\n\n\n\nWhat could be the reasons for the difference?\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}